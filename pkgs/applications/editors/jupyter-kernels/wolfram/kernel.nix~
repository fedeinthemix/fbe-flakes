{ stdenv,lib, fetchFromGitHub, fetchurl }:

stdenv.mkDerivation rec {
  pname = "wolfram-for-jupyter-kernel";
  version = "0.9.2";

  # src = fetchFromGitHub {
  #   owner = " WolframResearch";
  #   repo = "WolframLanguageForJupyter";
  #   rev = "v${version}";
  #   sha256 = "19d9dvr0bv7iy0x8mk4f576ha7z7h7id39nyrggwf9cp7gymxf47";
  # };

  src = fetchurl {
    url = "https://github.com/WolframResearch/WolframLanguageForJupyter/archive/refs/tags/v${version}.tar.gz";
    sha256 = "1lrlljxc901a6ykhvhwqsww6sl8gn8i15xjjifhjgbwdcvbvdx8y";
  };

  dontConfigure = true;
  dontInstall = true;
  
  buildPhase = ''
    patchShebangs ./configure-jupyter.wls
    mkdir -p $out/share/Wolfram
    # cp -r ../WolframLanguageForJupyter-${version} $out/share/Wolfram
    cp -r WolframLanguageForJupyter $out/share/Wolfram
    cp -r images $out/share/Wolfram
    cp -r extras $out/share/Wolfram
    cp LICENSE $out/share/Wolfram
    cp configure-jupyter.wls $out/share/Wolfram
  '';
  
  # no tests
  doCheck = false;

  meta = with lib; {
    description = "A Jupyter kernel for Wolfram Language.";
    homepage = "https://github.com/WolframResearch/WolframLanguageForJupyter";
    license = licenses.mit;
    maintainers = with maintainers; [ ];
    platforms = [ "x86_64-linux" ];
  };
}
